# HA Jenkins Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                    Internet                                         │
└───────────────────────────────────────┬─────────────────────────────────────────────┘
                                        │
┌───────────────────────────────────────┴─────────────────────────────────────────────┐
│                                    AWS VPC                                          │
│                                                                                     │
│   ┌─────────────────────────────────────────────────────────────────────────────┐   │
│   │                            Internet Gateway                                 │   │
│   └───────────────────────────────────┬─────────────────────────────────────────┘   │
│                                       │                                             │
│   ┌───────────────────────────────────┴─────────────────────────────────────────┐   │
│   │                         Public Subnets (Multi-AZ)                           │   │
│   │                                                                             │   │
│   │   ┌─────────────────┐                    ┌─────────────────┐                │   │
│   │   │   NAT Gateway   │                    │   Elastic IP    │                │   │
│   │   │   (AZ-1)        │                    │                 │                │   │
│   │   └─────────────────┘                    └─────────────────┘                │   │
│   └────────────────────────────────────┬────────────────────────────────────────┘   │
│                                        │                                            │
│   ┌────────────────────────────────────┴────────────────────────────────────────┐   │
│   │                         Private Subnets (Multi-AZ)                          │   │
│   │                                                                             │   │
│   │   ┌─────────────────────────────────────────────────────────────────────┐   │   │
│   │   │   Jenkins Server                                                    │   │   │
│   │   │   (EC2 Instance)                                                    │   │   │
│   │   │                                                                     │   │   │
│   │   │  • Custom AMI (jenkins-server)                                      │   │   │
│   │   │  • IAM Role (SSM access)                                            │   │   │
│   │   │  • Security Group (Jenkins UI, SSH access, WireGuard VPN)           │   │   │
│   │   └─────────────────────────────────┬───────────────────────────────────┘   │   │
│   │                                     │                                       │   │
│   │  ┌──────────────────────────────────┴────────────────────────────────────┐  │   │
│   │  │                          Auto Scaling Group                           │  │   │
│   │  │                                                                       │  │   │
│   │  │ ┌────────────────────────────────┐ ┌────────────────────────────────┐ │  │   │
│   │  │ │ Jenkins Worker                 │ │ Jenkins Worker                 │ │  │   │
│   │  │ │ (EC2 Instance)                 │ │ (EC2 Instance)                 │ │  │   │
│   │  │ │                                │ │                                │ │  │   │
│   │  │ │ • Custom AMI (jenkins-worker)  │ │ • Custom AMI (jenkins-worker)  │ │  │   │
│   │  │ │ • Docker (node.js, AWS CLI)    │ │ • Docker (node.js, AWS CLI)    │ │  │   │
│   │  │ │ • IAM Role (SSM and S3 access) │ │ • IAM Role (SSM and S3 access) │ │  │   │
│   │  │ │ • Security Group (SSH access)  │ │ • Security Group (SSH access)  │ │  │   │
│   │  │ └────────────────────────────────┘ └────────────────────────────────┘ │  │   │
│   │  └───────────────────────────────────────────────────────────────────────┘  │   │
│   │                                                                             │   │
│   │  ┌───────────────────────────────────────────────────────────────────────┐  │   │
│   │  │  Lambda Function                                                      │  │   │
│   │  │  (GitHub Webhook Handler)                                             │  │   │
│   │  │                                                                       │  │   │
│   │  │  • Python 3.12 Runtime                                                │  │   │
│   │  │  • VPC Configuration                                                  │  │   │
│   │  │  • IAM Role (SSM and VPC access)                                      │  │   │
│   │  └───────────────────────────────────────────────────────────────────────┘  │   │
│   └─────────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                   External Services                                 │
│                                                                                     │
│   ┌─────────────────────────────────────────────────────────────────────────────┐   │
│   │  API Gateway                                                                │   │
│   │                                                                             │   │
│   │  • REST API: /webhook endpoint                                              │   │
│   │  • POST method                                                              │   │
│   │  • Lambda integration                                                       │   │
│   │  • Stage: dev                                                               │   │
│   └───────────────────────────────────────┬─────────────────────────────────────┘   │
│                                           │                                         │
│   ┌───────────────────────────────────────┴─────────────────────────────────────┐   │
│   │  GitHub                                                                     │   │
│   │  (Webhook Source)                                                           │   │
│   │  git@github.com:calisera-io/calisera-project-blog.git                       │   │
│   └─────────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              AWS Services                                          │
│                                                                                     │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                    │
│  │   CloudWatch    │  │ Systems Manager │  │      IAM        │                    │
│  │                 │  │                 │  │                 │                    │
│  │ • CPU Alarms    │  │ • Parameter     │  │ • Roles         │                    │
│  │ • Auto Scaling  │  │   Store         │  │ • Policies      │                    │
│  │   Policies      │  │ • Credentials   │  │ • Instance      │                    │
│  │                 │  │                 │  │   Profiles      │                    │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                    │
│                                                                                     │
│  ┌─────────────────┐  ┌─────────────────┐                                         │
│  │       S3        │  │      Route      │                                         │
│  │                 │  │     Tables      │                                         │
│  │ • blog.calisera │  │                 │                                         │
│  │   .io bucket    │  │ • Public Route  │                                         │
│  │ • Worker access │  │ • Private Route │                                         │
│  │                 │  │                 │                                         │
│  └─────────────────┘  └─────────────────┘                                         │
└─────────────────────────────────────────────────────────────────────────────────────┘

Key Features:
• Multi-AZ deployment for high availability
• Auto Scaling based on CPU utilization (scale out at 80%, scale in at 20%)
• Custom AMIs for Jenkins server and workers
• Secure communication via SSH keys and VPN
• GitHub webhook integration via API Gateway and Lambda
• Systems Manager for credential management
• S3 integration for artifact storage
```
